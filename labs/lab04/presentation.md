---
## Front matter
lang: ru-RU
title: Инициализация систем BSD
author:
  - Борисенкова София Павловна
institute:
  - Российский университет дружбы народов, Москва, Россия
date: 27 сентября 2025

## i18n babel
babel-lang: russian
babel-otherlangs: english

## Formatting pdf
toc: false
slide_level: 2
aspectratio: 169
section-titles: true
theme: metropolis
header-includes:
 - \metroset{progressbar=frametitle,sectionpage=progressbar,numbering=fraction}
---
#Инициализация систем BSD
## План 

1.  Что такое инициализация?
2.  Отличия BSD от Linux (systemd, SysV)
3.  Основные компоненты:
    *   `init`
    *   `/etc/rc`
    *   `/etc/rc.conf`
    *   `rc.d` скрипты
4.  Этапы загрузки
5.  Управление службами
6.  Примеры FreeBSD, OpenBSD
7.  Заключение

## 1. Что такое инициализация?

*   **Инициализация (init)** — это процесс запуска операционной системы после загрузки ядра.
*   **Цели:**
    *   Проверка и монтирование файловых систем.
    *   Запуск критически важных системных служб (сеть, демоны cron, SSH и т.д.).
    *   Подготовка системы к работе в многопользовательском режиме.
*   В UNIX-подобных системах процесс инициализации всегда имеет **PID (Process ID) = 1**.

## 2. Отличия BSD от Linux

| Аспект | Мир Linux (современный) | Мир BSD |
| :--- | :--- | :--- |
| **Основной `init`** | `systemd`, `OpenRC` | **Собственный `init`** (часто потомок BSD `init`) |
| **Конфигурация** | Файлы `.service` (systemd), скрипты в `/etc/init.d/` | Единый файл **`/etc/rc.conf`** |
| **Философия** | Интеграция, параллельный запуск | **Простота, прозрачность, последовательность** |
| **Скрипты** | Зависимости описываются в скриптах/конфигах | Скрипты в **`/etc/rc.d/`**, запускаются по алфавиту с проверкой зависимостей |

> **Ключевая идея BSD:** Единая, целостная ОС, а не ядро + набор пакетов. Инициализация отражает это.

## 3. Основные компоненты системы инициализации BSD

### `/sbin/init`
*   Родительский процесс всех остальных процессов.
*   Читает конфигурационный файл `/etc/rc`.
*   Управляет переходами между уровнями выполнения (runlevels).

### `/etc/rc`
*   Главный shell-скрипт, управляющий процессом загрузки.
*   Выполняет общие для всех систем действия:
    *   Задает переменные (`/etc/rc.conf`).
    *   Монтирует файловые системы.
    *   Запускает сеть, системные службы.
    *   Запускает скрипты из `/etc/rc.d/` и `/usr/local/etc/rc.d/` (сторонние пакеты).

## 3. Основные компоненты (продолжение)

### `/etc/rc.conf`
*   **Сердце конфигурации загрузки.**
*   Простой текстовый файл с переменными в формате `переменная="значение"`.
*   Определяет, какие службы запускать и с какими параметрами.
    ```bash
    hostname="mybsd.server.com"
    ifconfig_em0="inet 192.168.1.10 netmask 255.255.255.0"
    sshd_enable="YES"
    mysql_enable="YES"
    ```

### `/etc/rc.d/` и `/usr/local/etc/rc.d/`
*   Директории, содержащие скрипты для управления отдельными службами.
*   Каждый скрипт стандартизирован и понимает команды: `start`, `stop`, `restart`, `status`.

## 4. Этапы загрузки (на примере FreeBSD)

1.  **Ядро:** Загружается загрузчиком. Инициализирует аппаратуру.
2.  **Процесс `init` (PID 1):** Запускается ядром.
3.  **Одноранговый режим (`single user`):**
    *   `init` выполняет `/etc/rc.bsdinstaller` (если есть) или переходит к следующему шагу.
    *   Запускает `/bin/sh` для `root` без сети. Для восстановления системы.
4.  **Многопользовательский режим (`multi user`):**
    *   `init` запускает главный скрипт `/etc/rc`.
    *   `/etc/rc` вызывает:
        *   `/etc/rc.sysctl` - настройка параметров ядра.
        *   `/etc/rc.network` - базовая настройка сети.
        *   `/etc/rc.diskless1` и `/etc/rc.diskless2` (для diskless-систем).
5.  **Запуск служб:** `/etc/rc` запускает скрипты из `/etc/rc.d/`, которые имеют `enable="YES"` в `rc.conf`.

## 5. Управление службами

*   **Ручной запуск/остановка:**
    ```bash
    # /etc/rc.d/sshd start
    # /etc/rc.d/sshd stop
    # /etc/rc.d/sshd restart
    ```

*   **Проверка статуса:**
    ```bash
    # /etc/rc.d/sshd status
    sshd is running as pid 1234.
    ```

*   **Включение/выключение автозапуска:**
    *   Отредактировать `/etc/rc.conf` и добавить/изменить строку:
    ```bash
    nginx_enable="YES"  # Включить
    nginx_enable="NO"   # Выключить
    ```

## 6. Примеры: FreeBSD vs OpenBSD

### FreeBSD
*   Классическая BSD-инициализация, как описано выше.
*   Гибкость, обширные возможности настройки через `rc.conf`.

### OpenBSD
*   Более минималистичный и безопасный по дизайну подход.
*   Файл конфигурации — `/etc/rc.conf.local` (для пользовательских настроек, системный `/etc/rc.conf` трогать не рекомендуется).
*   Скрипты в `/etc/rc.d/` проще.
*   Акцент на безопасности: например, по умолчанию многие службы отключены.

## 7. Заключение

*   Инициализация в BSD — **простая, предсказуемая и прозрачная**.
*   Централизованная конфигурация через `/etc/rc.conf` делает управление удобным.
*   Последовательный (непараллельный) запуск упрощает отладку.
*   Философия BSD — "все части ОС работают вместе" — ярко проявляется в процессе загрузки.
*   Понимание этой системы необходимо для эффективного администрирования серверов на базе BSD.
